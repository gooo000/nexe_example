#OpenRTB 说明文档


#1 说明

1. 技术文档帮助DSP(Demand Side Platform, 需求方平台)使用广告家的实时竞价接口。通过广告家的接口所传递的参数，匹配出最合适的广告做竞价。

2. 广告家和DSP之间实时交互，使用标准的HTTP协议，使用protocol buffers 格式，通过POST方式进行交互。

3. 您可以通过 http://code.google.com/p/protobuf 获取最新的 protocol buffers 技术支持。

##1.1 接入说明
----
1. DSP合作方 通过 商务流程:
	开通权限（DSPID，密钥数据）
	获取 技术帮助文档

2. DSP合作方 完成开发后 提供:
	实时竞价 请求接口（例如:http://www.dsp.com/bid）
	接口可支持的 最大 QPS(Query Per Second)

3. DSP合作方 联系 运营 进行 联调测试:
	系统 会给 DSP合作方 所提供的 竞价接口 发送 测试请求。

4. DSP合作方 联系 运营 开通 实时竞价 的 正式权限，并完成所有对接流程。


#2 实时竞价
----
1. 系统 将给 DSP合作方 所 提供 的 竞价接口 发送 数据请求，此请求采用 OpenRTB协议 格式封装 请求数据，并使用 标准 的 HTTP POST 方式发送，其中 HTTP 的 头部 字段 Content-Type 会 被设置为 application/octet-stream。

2. DSP合作方竞价广告，请采用 OpenRTB协议 格式封装 响应数据。系统等待 DSP合作方 响应 设置了 超时（例如：200毫秒）。未能在超时内响应，响应数据格式错误，将视为响应失败，且不参与竞价，当DSP合作方响应失败过高时，会逐渐减少请求流量。

3. 竞价成功后，会从媒体的页面发出HTTP请求，将此次 竞价成功 的 结算价格 反馈给 DSP合作方。
	
##2.2	请求接口
----
1. 按照OpenRTB协议的对象模型，发送给DSP合作方请求数据。

2. 使用HTTP POST方式 发送请求。

3. HTTP 的 头部 字段 Content-Type 会 被设置为 application/octet-stream。

###2.2.1	BidRequest
----
BidRequest是发送给DSP合作方请求数据的顶层对象。对象包含所有信息，例如：投标对象信息，页面信息，app应用的信息，目标用户信息，设备信息，是否测试请求 等信息。

```
属性名称			字段类型			描述
id				String 			实时竞价请求的唯一id。
imp	 			Object Array 	投标对象信息对象数组(Object:2.2.2)
site 			Object 			网站信息对象(Object:2.2.4)
app				Object			App应用信息对象(Object:2.2.5)
user			Object 			目标用户信息对象(Object:2.2.9)
device			Object 			设备信息对象(Object:2.2.7)
test 			int				是否测试 0:否 1:是, 默认:0
tmax 			int 			最大超时时间，单位：毫秒(ms)

```
###2.2.2 Imp
Imp是投标对象信息，展示广告的广告位信息。对象包含广告位的类型，最低价格等信息。

```
属性名称			字段类型			描述
id				String 			投标对象的自增id
banner	 		Object 			标准的横幅广告对象(Object:2.2.3)
bidfloor		float			最少出价

```
###2.2.3 Banner
Banner是一个横幅广告，可以展示图片／文字类型的广告信息。

```
属性名称			字段类型			描述
id				int				投标对象的自增值（imp.id）
w				int 			广告宽
h	 			int 			广告高
wmax			int 			最大宽
hmax			int				最大高
wmin			int				最小宽
hmin			int				最大宽
wtype 			int             广告类型(附件:5.2)
btype			int 			广告类型(附件:5.2)
battr			int				广告分类(附件:5.3)
pos				int				广告所在页面的位置(附件:5.4)
mimes			String 			广告 MIME types
keywords        String Array    关键字[kw1, kw2, kw3]


```
###2.2.4 Site
Site是网站信息对象，包含网站的内容分类，正文内容分类等信息。

```
属性名称			字段类型			描述
id				String			标示网站的唯一id
name			String			网站名称（title）
domain			String			网站域名（mysite.com）
cat				String			网站内容分类(附件:5.1)
sectioncat		String			页面正文内容分类(附件:5.1)
pagecat			String			页面内容分类(附件:5.1)
page			String			网站的地址
ref				String			网站的ref地址
search			String Object	网站搜索关键字(seo关键字)
mobile			int				是否支持手机 1:是 0:否 默认:0
publisher 		Object			媒体对象(Object:2.2.6)
keywords		String Array	关键字[kw1, kw2, kw3]
bwords			String Array	关键字[kw1, kw2, kw3]

```
### 2.2.5 App
App是app应用信息，包含app包名，类型，版本等信息。

```
属性名称			字段类型			描述
id				String			标示app的唯一id
name			String			app名称
bundle			String			package name
domain			String 			app网站域名
storeurl		String			app store的url
cat				String			app的内容分类(附件:5.1)
sectioncat		String			app正文的内容分类(附件:5.1)
pagecat			String			app内容的内容分类(附件:5.1)
ver				String			app版本
paid			int				是否付费app 0:否,1:是
publisher 		Object			媒体对象(Object:2.2.6)
keywords		String Array	关键字[kw1, kw2, kw3]

```
### 2.2.6 Publisher
Publisher是一个拍卖方的媒体对象，包含了媒体信息。

```
属性名称			字段类型			描述
id				String			媒体的唯一id
name			String			媒体名称
cat				String Array	媒体的内容(附件:5.1)
domain			String			媒体的域名

```
### 2.2.7 Device
Device是一个设备对象，包含设备的生产商，使用的系统等信息。

```
属性名称			字段类型			描述
ua				String			浏览器的 user-agent
geo 			Object			地理位置(Object:2.2.8)
ip				String			ipv4
devicetype 		int				设备类型(附件:5.7)
make			String			生产商(Apple)
model			String			设备模型(iPhone)
hwv				String 			硬件版本(5s)
os				String			系统(iOS)
osv				String			系统版本
w				int				设备宽
h				int				设备高
js				int				是否允许js 0:否 1:是 默认:0
language		String			浏览器的字符编码(utf-8)
connectiontype	int 			连接类型(附件:5.5)
imei			String			imei ID
mac				String			设备mac地址

```

### 2.2.8 Geo
Geo是一个地理位置对象，包括经纬度，省市，邮编

```
属性名称			字段类型			描述
lat				float			纬度从- 90 + 90，负的是南。
lon				float			经度从180到+ 180，负的是西。
type			int				地理位置的类型(附件:5.6)
country			String			国家
province		String			省级
city			String			市级
zip				String			邮编
utcoffset		int				时间偏移－/＋分钟
shop 			Object 			商户信息(Object:2.2.10)

```

### 2.2.9 User
User是一个用户信息对象

```
属性名称			字段类型			描述
id				String			唯一的用户标示id
buyerid			String			来自媒体的唯一用户标示id
yob				int				出生年份 4位整数
gender			String			性别 M=男,F=女,O=不明确
keywords		String Array	关键字
geo				Object			地理位置对象

```

### 2.2.10 Shop
Shop是一个商户wifi的信息对象

```
属性名称			字段类型			描述
id				String			商户的唯一id
name			String 			商户名称
shoptype		int				商户分类			

```

## 2.3 响应请求
----
1. 按照OpenRTB协议的对象模型，响应系统请求。

### 2.3.1 BidReponse
BidReponse是一个响应请求的顶层对象，包含投标的广告内容，价格，拒绝投标的理由等信息

```
属性名称			字段类型			描述
id				String			实时竞价请求的唯一id。
seatbid			Object Array	投标对象详细信息数组(Object:2.3.2)
bidid			String			投标人id, dspID
nbr				int				竞价出错(附件:5.8)

```

### 2.3.2 SeatBid
SeatBid 是一个投标广告的详细信息

```
属性名称			字段类型			描述
bid				Object Array	投标对象数组(Object:2.3.3)
seat 			String			一个广告实例id

```

### 2.3.3 Bid
Bid是响应投标广告的广告对象

```
属性名称			字段类型			描述
id				String			投标对象唯一ID(DSPID_广告ID)
impid			String			投标广告位的ID
price			float			竞投价格
adid			String			广告id
nurl			String			竞价成功后通知url
adm				String			广告的主要内容
adomain			String			广告域名
bundle			String			应用包名
iurl			Stirng			广告投放后的追踪url
cid				String			广告方案的id
crid			String			广告创意的id
cat				String			广告内容分类(附件:5.1)
attr			String			广告创意的分类(附件:5.3)
w				int				广告宽
h				int				广告高

```
# 3 加密解密
----


## 加密机制

我们使用自定义的加密机制对价格进行加密，其设计可尽量缩减加密文件的大小，同时保证所需的安全性。这项加密机制使用密钥验证 HMAC 算法，可根据唯一展示活动 ID 来生成秘密的填补内容。

加密价格的长度固定为 28 个字节，其中包含 16 个字节的初始化矢量、8 个字节的密文以及 4 个字节的完整性签名。加密的价格根据 RFC 3548 使用网络安全 base64 方式编码，会省略填补的字符。因此，28 个字节的加密价格会被编成 38 个字符的网络安全 base-64 字符串。

加密格式如下：

        {initialization_vector (16 bytes)}{encrypted_price (8 bytes)}
        {integrity (4 bytes)}
价格会被加密成 <price xor HMAC(encryption_key, initialization_vector)> 的格式，解密时系统会计算加密价格的 HMAC(encryption_key,initialization_vector) 和 xor 以恢复到加密前的结果。完整性阶段会使用 4 个字节的 <HMAC(integrity_key, price||initialization_vector)>，其中 || 表示“并列”的意思。

### 输入内容

iv: 初始化矢量（16 个字节 - 展示专用值）

e_key: 加密密钥（32 个字节 - 在创建帐户时提供）

i_key: 完整性密钥（32 个字节 - 在创建帐户时提供）

price: （8 个字节 - 以帐户币种的百万分之一表示）

### 表示法

hmac(k, d): 数据 d 的 SHA-1 HMAC，使用密钥 k。
a || b: 字符串 a 和字符串 b 并列
### 伪代码

	pad = hmac(e_key, iv)  // 前 8 个字节
	enc_price = pad <xor> price
	signature = hmac(i_key, price || iv)  // 前 4 个字节

	final_message = WebSafeBase64Encode( iv || enc_price || signature )

## 解密机制

您的解密代码必须使用加密密钥对价格进行解密，并使用完整性密钥验证完整性位元。您在设置时就会获得密钥。至于如何组织实施，则完全由您决定。您应该可以直接引用绝大多数示例代码，然后再根据需要进行修改。

### 输入内容

e_key: 加密密钥，32 个字节 - 在创建帐户时提供

i_key: 完整性密钥，32 个字节 - 在创建帐户时提供

final_message: 使用网络安全 base64 编码的 38 个字符

### 伪代码

	enc_price = WebSafeBase64Decode(final_message)
	(iv, p, sig) = dec_price -- split up according to fixed lengths
	price_pad = hmac(e_key, iv)
	price = p <xor> price_pad
	conf_sig = hmac(i_key, price || iv)
	success = (conf_sig == sig)

# 4 示例
----

# 5 附件
----

### 5.1 内容分类 Content Categories

```
键			值
801			汽车和交通工具
80101		小型车
80102		越野车
80103		重型车
80106		自行车及配件
80107		摩托车及配件
80108		交通法规
80110		维修配件
802			投资理财
80201		保险
80203		股票
80205		理财
80206		基金
80207		期货
80210		外汇
80212		银行
80213		债券
80214		信用借贷
80215		会计审计
80216		经济新闻
803			母婴
80301		孕产
80302		养育
80303		早教
804			健康医疗
80401		健康养生
80402		疾病治疗
80403		整型整容
80404		两性
80405		减肥
805			游戏
80501		网络游戏
80502		小游戏
80503		单机游戏
80504		网页游戏
80505		掌上游戏
80506		手机游戏
80507		桌上游戏
80509		游戏周边
806			娱乐影音
80601		影视
80601		影视
80601		影视
80601		影视
80601		影视
80601		影视
80601		影视
80601		影视
80601		影视
80602		音乐
80603		动漫
80604		美图
80605		星座占卜
80606		搞笑
80607		表演艺术
80608		娱乐八卦
80609		成人娱乐
808			教育培训
80801		应试
80803		培训
80805		出国
80806		自考
80808		社会科学
80809		自然科学
809			求职招聘
80901		求职
80902		招聘
810			家居家电
81001		家居设计
81002		装修
81003		装饰
81005		家电
81007		卧室
81008		厨房
81009		卫浴
811			房地产
81101		房产
81102		出租
81103		物业
81105		商业地产
812			体育运动
81201		足球
81202		篮球
81203		排球
81204		网球
81206		乒乓球
81207		田径
81208		体操
81209		赛车
81210		户外运动
81211		水上运动
81212		冰雪运动
81213		搏击运动
81214		赛事转播
81215		体育新闻
81216		其他运动
81217		健身
813			交通旅游
81301		酒店住宿
81302		旅行交通
81303		旅游服务
81304		景点
81305		节假日
81306		地图
81307		天气
81309		特色旅游
814			潮流时尚
81401		时尚
81402		美容
81403		情感
81405		美发
815			食品饮料
81501		美食
81502		零食
81503		饮料
81504		烟酒
816			IT数码
81601		手机
81602		笔记本
81603		平板
81604		台式机
81605		数码相机
81606		数码影音
81607		电脑硬件
81608		企业办公
81609		软件
81610		手机app
817			工农业与垂直行业
81701		农林牧渔
81702		电子电工
81703		机械设备
81704		化工业
81705		医药生物
81706		纺织制衣
81707		金属矿业
81709		能源
81710		航天国防
81711		制造业
81712		出版业
81713		建造业
81715		购物券优惠券
81716		商品购物（电商）
818			生活服务
81804		宠物服务
81805		家政服务
81816		鲜花绿植
81817		娱乐休闲
81822		婚庆、婚纱
81823		彩票
819			商务服务
81901		企业服务
81902		物流仓储
81903		IT服务
820			人文艺术
82001		摄影
82002		艺术收藏
82003		美术设计
82005		小说电子书
82006		书籍文学
82008		人文地理
82010		工艺制作
822			社交与网络服务
82201		婚恋交友
82202		SNS、社交
82204		网络服务
82207		导航
82208		网络门户
823			法律、社会、政府
82301		法律
82302		时政新闻
82303		军事
82304		社会
82305		政府
82306		宗教
82308		民族
824			其他
825			学习参考
82501		IT学习(编程	)
82502		语言学习
82503		字典、百科
82504		范文写作
82505		商务参考（ppt、简历制作等）
82506		技术参考
82507		参考工具

```

### 5.2 广告类型 Banner Ad Types

```
键			值
1			文字
2			图片
3			js
4			iframe

```

### 5.3 广告属性 Creative Attributes

```
键			值
706			办公用品
70601		办公设备及配件
70602		办公耗材
70603		文具
70699		其他办公用品
711			车辆
71101		微型车
71102		小型车
71103		紧凑型车
71104		中型车
71105		中大型车
71106		豪华车
71107		SUV
71108		MPV
71109		跑车
71110		商用车
71111		特种车辆
71112		汽车公司集团
71113		汽车实体服务
71114		汽车零配
71115		汽车电子
71116		汽车内饰
71117		汽车外饰
71118		摩托及配件
71119		养护维修改装
71120		天然气/石油加油站
71121		自行车/助动车/电瓶车
71199		其他车辆相关
720			法律与政府
72001		政府、社会组织
72002		法律
72003		军队
72005		政府服务
72006		紧急服务
72007		公共服务
72008		社会福利保障
72099		其他法律与政府
722			房地产
72201		出售
72202		出租
72203		拍卖
72204		房地产开发经营
72205		房地产中介服务
72206		商品房
72207		商铺
72208		写字楼
72209		新房
72210		二手房
72211		物业管理
72212		私人社区
72299		其他房地产相关
701			服装内衣
70101		女装
70102		女士内衣
70103		男装
70104		男士内衣
70105		亲子装
70106		家居服
70107		场合礼服
70108		袜子
70109		泳装
70110		运动服
70111		服装面料
70199		其他服装内衣
719			互联网与电信
71901		安全
71902		电子商务平台
71903		服务器
71904		软件服务
71905		通信
71906		移动互联
71907		硬件服务
71908		域名服务
71909		云计算
71910		支付平台服务
71911		有线电视服务
71912		卫星服务
71913		电话会议
71914		网络电话
71999		其他互联网与电信
709			家居生活
70901		家装建材
70902		家居饰品
70903		厨房用具
70904		布艺软饰
70905		家具
70906		床上用品
70907		卫浴
70908		灯具
70909		清洁用品
70910		五金工具
70911		日用品
70913		收纳储物
70915		婚庆用品
70917		创意礼品
70917		宠物/食品及用品
70999		其他家居生活
705			家用电器
70501		生活电器
70502		大家电
70503		影音电器
70504		健康护理电器
70505		厨卫电器
70506		家电配件
70599		其他家用电器
721			金融
72101		保险
72102		典当
72103		股票
72104		贵金属
72105		理财
72106		基金
72107		期货
72108		期指
72109		私募
72110		外汇
72111		信托
72112		银行
72113		债券
72114		信用借贷
72115		会计审计
72116		商业金融
72117		P2P
72199		其他金融相关
717			旅行与旅游
71701		出境游
71702		国内游
71703		周边游
71704		特种旅游
71705		户外探险
71706		酒店服务
71707		旅游保险
71708		旅行社
71799		其他旅行和旅游
707			美容与个人护理
70701		面部护理
70702		身体护理
70703		彩妆
70704		美容工具
70705		美发护发
70706		男性护理
70707		香水香氛
70708		美容机构
70709		整容
70710		减肥
70711		丰胸
70712		温泉及医疗水疗
70713		口腔护理
70714		个人清洁
70799		其他美容与个人护理
708			母婴
70801		玩具
70802		婴幼食品
70803		婴幼用品
70804		婴童服装配饰
70805		孕产妇用品/胎教
70806		孕产妇营养品
70899		其他母婴相关
723			农林牧渔
72301		畜牧家禽
72302		林业
72303		园艺
72304		作物
72305		蔬菜
72306		中草药
72307		水产养殖与渔业
72308		天然纤维
72309		特种养殖
72310		饲料
72311		肥料
72312		农用化学品
72313		农机工程
72314		农业研究
72315		农产品检测与分析
72399		其他农林牧渔相关
725			票务
72501		交通票务
72502		景点门票
72503		赛事票务
72504		优惠券与折扣
72505		娱乐票务
72599		其他票务服务
799			其他
79901		其他
718			商务服务
71801		财务会计
71802		起名服务
71803		法律咨询
71804		公司注册
71805		广告传媒
71806		设计策划
71807		人力资源
71808		认证服务
71809		上市咨询
71810		投资担保
71811		货运专线
71812		物流快递
71813		法律咨询
71814		招商加盟
71815		知识产权
71816		IT服务
71817		喷绘制卡
71818		印刷包装
71819		礼品定制
71820		展会服务
71821		翻译速记
71822		安装维修
71899		其他商务服务
724			商业与工业
72401		包装纸业
72402		船舶
72403		电子电工
72404		纺织
72405		环保
72406		机床机械
72407		机电
72408		建筑建材
72409		能源产业
72410		化学工业
72411		五金工具
72412		冶金矿产
72413		仪器仪表
72414		照明
72415		航天与国防
72416		商业管理
72417		商业和工业打印
72418		设计与工程
72419		食品生产和服务
72420		进出口
72421		零售贸易
72422		科学设备及服务
72423		安全设备及服务
72424		运输
72499		其他商业与工业相关
716			生活服务
71601		搬家服务
71602		殡葬服务
71603		餐饮服务
71604		宠物服务
71605		代办服务
71606		房产服务
71607		礼品服务
71608		婚庆服务
71609		家政服务
71610		洗衣保洁
71611		生活配送
71612		租车订车
71613		缴费充值
71614		安装维修
71615		物流仓储
71616		鲜花绿植
71617		安全与保安
71618		娱乐休闲
71619		征婚交友
71620		装修设计
71621		宗教/起名/解梦
71699		其他生活服务
710			食品饮料
71001		休闲零食
71002		奶粉乳品
71003		粮油米面/南北干货/调味品
71004		生鲜蔬果
71005		非酒精饮料
71006		酒类饮料
71007		茶叶
71008		营养保健
71099		其他食品饮料
704			手机数码与消费电子
70401		手机
70402		相机/摄像机
70403		电玩
70404		影音产品
70405		笔记本
70406		平板电脑
70407		台式机/一体机/服务器
70408		网络设备
70409		电脑硬件
70410		数码配件
70499		其他手机数码与消费电子
703			体育健身与户外运动
70301		体育用品
70302		棋牌益智
70303		健身器械
70305		户外用品
70306		体育迷用品
70307		体育教学与教练
70308		体育场馆设施
70399		其他体育健身与户外运动
702			鞋包配饰
70201		男鞋
70202		女鞋
70203		运动鞋
70204		女士配饰
70205		男士配饰
70206		箱包
70207		眼镜及配件
70208		皮具及配件
70209		帽子围巾手套
70210		珠宝/饰品
70212		手表
70299		其他鞋包配饰
726			新闻媒体与出版物
72601		女性媒体和出版物
72602		男性媒体和出版物
72603		青少年媒体和出版物
72604		婴幼儿媒体和出版物
72605		本地新闻媒体和出版物
72606		国内新闻媒体和出版物
72607		世界新闻与媒体
72608		报刊杂志订阅
72609		网络媒体
72610		新闻媒体
72611		出版
72612		参考材料
72699		其他新闻媒体和出版物
714			医疗保健
71401		药品
71402		保健用品
71403		医疗服务
71404		医疗机构
71405		医疗器械及设备
71499		其他医疗保健
715			艺术与娱乐
71501		电视
71502		电影
71503		电子书
71504		动漫
71505		古董和收藏
71506		工艺品
71507		乐器及配件
71508		珍藏玩具及爱好
71509		摄影
71510		演出
71511		音乐
71512		音像
71514		彩票
71515		成人娱乐
71516		书籍
71599		其他艺术与娱乐
713			游戏
71301		网络游戏
71302		网页游戏
71303		单机游戏
71304		电子竞技
71305		手机游戏
71306		小游戏
71307		桌上游戏
71308		游戏厅
71309		游戏周边
71399		其他游戏
712			职业与教育
71201		IT培训
71202		设计培训
71204		外语培训
71205		文艺培训
71206		职业技能培训
71207		管理/MBA
71208		婴幼早教
71209		家教
71210		招聘信息
71211		求职信息
71212		学历教育
71213		学校/培训机构
71214		出国留学/移民
71215		其他求职招聘
71299		其他教育培训
727			成人用品
72701		计生用品
72702		成人器具
72703		情趣内衣
901			移动应用
90101		儿童
90102		教育
90103		报刊杂志
90104		摄影与录像
90105		效率
90106		生活
90107		健康健美
90108		旅游
90109		音乐
90110		体育
90111		商务
90112		新闻
90113		工具
90114		娱乐
90115		社交
90116		美食佳饮
90117		财务
90118		参考
90119		导航
90120		医疗
90121		图书
90122		天气
90123		商品指南
90199		其他移动应用

```

### 5.4 广告位置 Ad Position

```
键			值
0			不确定
1			顶部浮动
2			不可见
3			底部浮动
4			头部
5			尾部
6			侧边栏
7			全屏

```

### 5.5 连接类型 Connection Type

```
键			值
0			不确定
1			网路运营商
2			WIFI
3			手机运营商－不确定
4			手机运营商－2G
5			手机运营商－3G
6			手机运营商－4G

```

### 5.6 位置类型 Location Type

```
键			值
1			GPS 经纬度
2			IP地址
3			用户定制

```

### 5.7 设备类型 Device Type

```
键			值
1			Mobile
2			PC

```

### 5.7 竞价错误 No-Bid Reason Codes

```
键			值
0			无错误
1			竞价出错/拒绝竞价
2			无效的竞价请求

```

